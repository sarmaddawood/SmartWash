@model SmartWash.ViewModels.Admin.AdminDashboardViewModel
@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = "Executive Overview";
    ViewData["ActivePage"] = "AdminDashboard";
}

<div class="row g-3 g-md-4 mb-4">
    <!-- Total Customers Card -->
    <div class="col-12 col-md-6 col-xl-3">
        <div class="card border-0 p-3 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span class="text-muted small fw-bold text-uppercase">Total Customers</span>
                <div class="bg-primary-subtle p-2 rounded-3 text-primary"><i class="bi bi-people-fill"></i></div>
            </div>
            <div class="d-flex align-items-baseline">
                <h2 class="fw-bold mb-0">@Model.TotalCustomers</h2>
                <span class="ms-2 text-success small fw-bold">+12.5%</span>
            </div>
            <div class="mt-3">
                <div class="progress" style="height: 6px; border-radius: 10px;">
                    <div class="progress-bar bg-primary" style="width: 70%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Card (Extej Balance Style) -->
    <div class="col-12 col-md-6 col-xl-3">
        <div class="card border-0 p-3 h-100 text-white" style="background: linear-gradient(135deg, #1A1F36 0%, #2D3748 100%);">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span class="small fw-bold text-uppercase text-white-50">Total Revenue</span>
                <div class="bg-white-50 p-2 rounded-3"><i class="bi bi-wallet2"></i></div>
            </div>
            <h2 class="fw-bold mb-0">₱@Model.TotalRevenue.ToString("N0")</h2>
            <div class="mt-3 d-flex justify-content-between align-items-center">
                <span class="small text-white-50">Available Funds</span>
                <span class="badge bg-success">+14.2%</span>
            </div>
        </div>
    </div>

    <!-- Pending Orders -->
    <div class="col-12 col-md-6 col-xl-3">
        <div class="card border-0 p-3 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span class="text-muted small fw-bold text-uppercase">Queue Waitlist</span>
                <div class="bg-warning-subtle p-2 rounded-3 text-warning"><i class="bi bi-hourglass-split"></i></div>
            </div>
            <h2 class="fw-bold mb-0">@Model.PendingOrders</h2>
            <p class="text-muted small mt-2 mb-0">Orders awaiting processing</p>
        </div>
    </div>

    <!-- Active Orders -->
    <div class="col-12 col-md-6 col-xl-3">
        <div class="card border-0 p-3 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span class="text-muted small fw-bold text-uppercase">In Operations</span>
                <div class="bg-info-subtle p-2 rounded-3 text-info"><i class="bi bi-gear-fill"></i></div>
            </div>
            <h2 class="fw-bold mb-0">@Model.ActiveOrders</h2>
            <div class="mt-3">
                <span class="badge bg-info-subtle text-info rounded-pill">Active Now</span>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm rounded-4">
            <div class="card-header bg-white border-0 py-3 px-4">
                <h5 class="fw-bold mb-0">Revenue Trend</h5>
            </div>
            <div class="card-body p-4">
                <canvas id="revenueChart" style="height: 300px;"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4">
            <div class="card-header bg-white border-0 py-3 px-4">
                <h5 class="fw-bold mb-0">Order Status</h5>
            </div>
            <div class="card-body p-4">
                <canvas id="statusChart" style="height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="card-header bg-white border-0 py-3 px-4 d-flex justify-content-between align-items-center">
        <h5 class="fw-bold mb-0">Recent Orders</h5>
        <a asp-action="Orders" class="btn btn-primary btn-sm rounded-pill px-3">View All</a>
    </div>
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="bg-light">
                <tr>
                    <th class="ps-4">Order ID</th>
                    <th>Customer</th>
                    <th>Status</th>
                    <th class="text-end pe-4">Amount</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model.RecentOrders)
                {
                    <tr>
                        <td class="ps-4">#@order.Id.ToString().Substring(0, 8)</td>
                        <td>@order.Customer?.FullName</td>
                        <td>
                            <span class="badge rounded-pill bg-light text-dark border px-3">@order.Status</span>
                        </td>
                        <td class="text-end pe-4 fw-bold">₱@order.TotalPrice.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="card border-0 shadow-sm rounded-4 overflow-hidden mt-4">
    <div class="card-header bg-white border-0 py-3 px-4">
        <h5 class="fw-bold mb-0">Staff Performance</h5>
    </div>
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="bg-light">
                <tr>
                    <th class="ps-4">Staff Name</th>
                    <th>Completed Orders</th>
                    <th class="text-end pe-4">Avg Processing Time</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.StaffPerformance.Any())
                {
                    <tr>
                        <td colspan="3" class="text-center py-4 text-muted small">No performance data available yet.</td>
                    </tr>
                }
                @foreach (var p in Model.StaffPerformance)
                {
                    <tr>
                        <td class="ps-4 fw-bold">@p.StaffName</td>
                        <td>@p.CompletedOrders</td>
                        <td class="text-end pe-4">
                            <span class="badge bg-info-subtle text-info px-3">@TimeSpan.FromMinutes(p.AverageCompletionTimeMinutes).ToString(@"hh\:mm") hrs</span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // Revenue Chart
        const revCtx = document.getElementById('revenueChart').getContext('2d');
        new Chart(revCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.RevenueTrend.Select(r => r.Month))),
                datasets: [{
                    label: 'Revenue (₱)',
                    data: @Html.Raw(Json.Serialize(Model.RevenueTrend.Select(r => r.Amount))),
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });

        // Status Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.OrdersByStatus.Keys)),
                datasets: [{
                    data: @Html.Raw(Json.Serialize(Model.OrdersByStatus.Values)),
                    backgroundColor: ['#f59e0b', '#3b82f6', '#10b981', '#6366f1', '#6b7280']
                }]
            },
            options: {
                plugins: { legend: { position: 'bottom' } },
                cutout: '70()'
            }
        });
    </script>
}
