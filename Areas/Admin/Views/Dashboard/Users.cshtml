@model List<SmartWash.ViewModels.Admin.UserManagementViewModel>
@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = "User Management";
    ViewData["ActivePage"] = "AdminUsers";
}

<div class="row mb-4 align-items-center">
    <div class="col-md-6">
        <h2 class="fw-bold mb-1">User Management</h2>
        <p class="text-muted mb-0">Manage system users, staff, and account statuses</p>
    </div>
    <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <a asp-action="CreateStaff" class="btn btn-primary rounded-pill px-4 shadow-sm"><i class="bi bi-person-plus me-2"></i> Add Staff</a>
    </div>
</div>

<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="bg-light">
                <tr>
                    <th class="ps-4">Name / Email</th>
                    <th>Role</th>
                    <th>Account Status</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td class="ps-4">
                            <div class="fw-bold">@user.FullName</div>
                            <div class="small text-muted">@user.Email</div>
                        </td>
                        <td>
                            @if (user.Role.Contains("Admin"))
                            {
                                <span class="badge bg-danger-subtle text-danger px-3 rounded-pill">Admin</span>
                            }
                            else if (user.Role.Contains("Staff"))
                            {
                                <span class="badge bg-success-subtle text-success px-3 rounded-pill">Staff</span>
                            }
                            else
                            {
                                <span class="badge bg-primary-subtle text-primary px-3 rounded-pill">Customer</span>
                            }
                        </td>
                        <td>
                            @if (user.IsLockedOut)
                            {
                                <span class="text-danger small fw-bold"><i class="bi bi-x-circle-fill me-1"></i> Deactivated</span>
                            }
                            else
                            {
                                <span class="text-success small fw-bold"><i class="bi bi-check-circle-fill me-1"></i> Active</span>
                            }
                        </td>
                        <td class="text-end pe-4">
                            <div class="d-flex justify-content-end gap-2">
                                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3">View Profile</button>
                                @if (user.IsLockedOut)
                                {
                                    <form asp-action="ReactivateUser" method="post">
                                        <input type="hidden" name="id" value="@user.UserId" />
                                        <button type="submit" class="btn btn-sm btn-success rounded-pill px-3">Activate</button>
                                    </form>
                                }
                                else
                                {
                                    <form asp-action="DeactivateUser" method="post">
                                        <input type="hidden" name="id" value="@user.UserId" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger rounded-pill px-3">Deactivate</button>
                                    </form>
                                }
                                <form asp-action="DeleteUser" method="post" onsubmit="return confirm('Are you sure you want to delete this user? This cannot be undone.')">
                                    <input type="hidden" name="id" value="@user.UserId" />
                                    <button type="submit" class="btn btn-sm btn-danger rounded-pill px-3">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
